C51 COMPILER V9.60.7.0   MAIN                                                              07/24/2024 11:59:06 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\AppData\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listi
                    -ngs\main.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include "Config.h"
   2          #include "Delay.h"
   3          #include "NVIC.h"
   4          #include "UART.h"
   5          #include "Switch.h"
   6          #include "GPIO.h"
   7          #include "Exti.h"
   8          #include "PCF8563.h"
   9          
  10          /**
  11           * @author HonestLiu
  12           * @note è¿™ä¸ªç¨‹åºé€šè¿‡æ“ä½œI2Cçš„é€šä¿¡åè®®è®¾ç½®äº†é—¹é’Ÿå¹¶è®¾ç½®äº†æ—¶é—´ï¼Œé—¹é’Ÿå°†ä¼šåœ¨ç¨‹å
             -ºå¯åŠ¨çš„6ç§’å†…è§¦å‘ï¼Œç”±äºŽPCF8563èŠ¯ç‰‡çš„RTC_INTå¼•è„šè¿žæŽ¥çš„æ—¶MCUçš„P37æ”¯æŒä¸­æ–­æ£€æµ‹çš„å¼•è„š
  13           * æ•…å½“ä¸­æ–­è§¦å‘æ—¶ï¼Œä¼šè§¦å‘INT3çš„ä¸­æ–­å›žè°ƒå‡½æ•°ï¼Œé€šè¿‡ä¸²å£æ‰“å°é—¹é’Ÿå“åº”çš„ä¿¡æ¯
  14           * */
  15          
  16          /****************  GPIOåˆå§‹åŒ–å‡½æ•° *****************/
  17          void GPIO_config(void) {
  18   1          //åˆå§‹åŒ–PCF8563çš„RTC_INTå¼•è„š -- P37(ä¸­æ–­å¼•è„š3)
  19   1          GPIO_InitTypeDef gpio_init_struct;
  20   1          gpio_init_struct.Mode = GPIO_PullUp;
  21   1          gpio_init_struct.Pin = GPIO_Pin_7;
  22   1          GPIO_Inilize(GPIO_P3, &gpio_init_struct);
  23   1      
  24   1          P3_MODE_IO_PU(GPIO_Pin_0 | GPIO_Pin_1);
  25   1      }
  26          
  27          /******************** INTé…ç½® ********************/
  28          void Exti_config(void) {
  29   1          EXTI_InitTypeDef Exti_InitStructure;                            //ç»“æž„å®šä¹‰
  30   1      
  31   1          Exti_InitStructure.EXTI_Mode = EXT_MODE_Fall;//ä¸­æ–­æ¨¡å¼,åªç›‘å¬ä¸‹é™æ²¿
  32   1          Ext_Inilize(EXT_INT3, &Exti_InitStructure);                //åˆå§‹åŒ–ä¸­æ–­3ï¼Œå¯¹åº”å¼•è„šæ˜¯p37
  33   1          NVIC_INT0_Init(ENABLE,
  34   1                         Priority_0);        //ä¸­æ–­ä½¿èƒ½, ENABLE/DISABLE; ä¼˜å…ˆçº§(ä½Žåˆ°é«˜) Priority_0,Pri
             -ority_1,Priority_2,Priority_3
  35   1      }
  36          
  37          /****************  UARTåˆå§‹åŒ–å‡½æ•° *****************/
  38          void UART_config(void) {
  39   1          // >>> è®°å¾—æ·»åŠ  NVIC.c, UART.c, UART_Isr.c <<<
  40   1          COMx_InitDefine COMx_InitStructure;                    //ç»“æž„å®šä¹‰
  41   1          COMx_InitStructure.UART_Mode = UART_8bit_BRTx;    //æ¨¡å¼, UART_ShiftRight,UART_8bit_BRTx,UART_9bit,U
             -ART_9bit_BRTx
  42   1          COMx_InitStructure.UART_BRT_Use = BRT_Timer1;            //é€‰æ‹©æ³¢ç‰¹çŽ‡å‘ç”Ÿå™¨, BRT_Timer1, BRT_T
             -imer2 (æ³¨æ„: ä¸²å£2å›ºå®šä½¿ç”¨BRT_Timer2)
  43   1          COMx_InitStructure.UART_BaudRate = 115200ul;            //æ³¢ç‰¹çŽ‡, ä¸€èˆ¬ 110 ~ 115200
  44   1          COMx_InitStructure.UART_RxEnable = ENABLE;                //æŽ¥æ”¶å…è®¸,   ENABLEæˆ–DISABLE
  45   1          COMx_InitStructure.BaudRateDouble = DISABLE;            //æ³¢ç‰¹çŽ‡åŠ å€, ENABLEæˆ–DISABLE
  46   1          UART_Configuration(UART1, &COMx_InitStructure);        //åˆå§‹åŒ–ä¸²å£1 UART1,UART2,UART3,UART4
  47   1      
  48   1          NVIC_UART1_Init(ENABLE,
  49   1                          Priority_1);        //ä¸­æ–­ä½¿èƒ½, ENABLE/DISABLE; ä¼˜å…ˆçº§(ä½Žåˆ°é«˜) Priority_0,Pr
             -iority_1,Priority_2,Priority_3
C51 COMPILER V9.60.7.0   MAIN                                                              07/24/2024 11:59:06 PAGE 2   

  50   1          UART1_SW(UART1_SW_P30_P31);        // å¼•è„šé€‰æ‹©, UART1_SW_P30_P31,UART1_SW_P36_P37,UART1_SW_P16_P17
             -,UART1_SW_P43_P44
  51   1      }
  52          
  53          //é—¹é’Ÿä¸­æ–­è§¦å‘è°ƒç”¨å‡½æ•°
  54          void PCF8536_on_alarm() {
  55   1          printf("int3_call Alarm\n");
  56   1      }
  57          
  58          //å®šæ—¶å™¨ä¸­æ–­è§¦å‘è°ƒç”¨å‡½æ•°
  59          void PCF8536_on_timer() {
  60   1          printf("int3_call Timer\n");
  61   1      }
  62          
  63          int main() {
  64   1          //æ—¥æœŸç»“æž„ä½“ï¼Œå­˜å‚¨è½¬æ¢åŽçš„è¦è®¾ç½®çš„å€¼
  65   1          Clock_t c;
  66   1          //é—¹é’Ÿç»“æž„ä½“
  67   1          Alarm_t a;
  68   1      
  69   1          EAXSFR();//ä½¿èƒ½æ‹“å±•å¯„å­˜å™¨
  70   1      
  71   1          PCF8563_init();//åˆå§‹åŒ–I2C
  72   1          UART_config();
  73   1          GPIO_config();
  74   1          Exti_config();
  75   1      
  76   1          EA = 1;//ä½¿èƒ½ä¸­æ–­
  77   1      
  78   1          /*è®¾ç½®RTCèŠ¯ç‰‡æ—¶é—´*/
  79   1          //å‡†å¤‡è¦è®¾ç½®çš„æ•°æ®
  80   1          c.year = 2024, c.month = 6, c.day = 29, c.week = 1, c.hour = 23, c.minute = 59, c.second = 54;
  81   1          //è¿›è¡Œæ—¶é—´è®¾ç½®
  82   1          PCF8563_set(c);
  83   1      
  84   1          /*4.è®¾ç½®é—¹é’Ÿæ—¶é—´ -- è¿™æ ·å½“é—¹é’Ÿè§¦å‘æ—¶INTå¼•è„šå°±ä¼šè§¦å‘ä¸€ä¸ªä¸­æ–­ï¼Œä½¿ç”¨æ”¯æŒEXIT
             -çš„å¼•è„šåŽ»æ£€æµ‹å³å¯*/
  85   1          a.minute = 0;
  86   1          a.hour = 0;
  87   1          a.day = 30;
  88   1          a.week_day = 2;
  89   1          PCF8563_set_alarm(a);
  90   1      
  91   1          //TODO å¦‚æžœåªéœ€è¦ä½¿ç”¨å®šæ—¶å™¨/é—¹é’Ÿå…¶ä¸€ï¼ŒåŠ¡å¿…ä½¿ç”¨å¤±èƒ½å‡½æ•°å¯¹å…¶è¿›è¡Œå¤±èƒ½ï¼Œå¦å
             -ˆ™å¯èƒ½ä¼šå› ä¸ºèŠ¯ç‰‡æ­¤å‰çš„è®¾ç½®è€Œå¯¼è‡´å‡ºé”™
  92   1      
  93   1          /*é…ç½®çŠ¶æ€æŽ§åˆ¶å¯„å­˜å™¨2å¯ç”¨é—¹é’Ÿ/è­¦æŠ¥Alarm*/
  94   1          PCF8563_enable_alarm();
  95   1          //PCF8563_disable_alarm();
  96   1      
  97   1          /*è®¾ç½®RTC Timerå®šæ—¶å™¨*/
  98   1          //æ—¶é’Ÿæºé€‰æ‹©64Hz,å€’è®¡æ—¶å€¼ä¸º64
  99   1          PCF8563_set_timer(Hz64, 64);
 100   1          //æ¸…é™¤å®šæ—¶å™¨æ ‡è®°å’Œä½¿èƒ½å®šæ—¶å™¨ä¸­æ–­
 101   1          PCF8563_enable_timer();
 102   1      
 103   1      
 104   1          while (1) {
 105   2              /*å¾ªçŽ¯è¯»å–RTCèŠ¯ç‰‡çš„æ•°æ®*/
 106   2              PCF8563_get(&c);
 107   2      
 108   2              printf("Hour:%d;Minute:%d;c.second: %d\n", (int) c.hour, (int) c.minute, (int) c.second);
C51 COMPILER V9.60.7.0   MAIN                                                              07/24/2024 11:59:06 PAGE 3   

 109   2              //printf("%d-%d-%d-%d-%d-%d,Week:%d\n", (int) c.year, (int) c.month, (int) c.day, (int) c.hour, (i
             -nt) c.minute,
 110   2      //               (int) c.second, (int) c.week);
 111   2      
 112   2              delay_ms(250);
 113   2              delay_ms(250);
 114   2              delay_ms(250);
 115   2              delay_ms(250);
 116   2          }
 117   1      
 118   1      
 119   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    271    ----
   CONSTANT SIZE    =     66    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      24
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
