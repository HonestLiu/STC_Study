C51 COMPILER V9.60.7.0   MAIN                                                              06/13/2024 14:16:16 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\AppData\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listi
                    -ngs\main.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          #include "Config.h"
   2          #include "GPIO.h"
   3          #include "UART.h"
   4          #include "NVIC.h"
   5          #include "Delay.h"
   6          #include "Switch.h"
   7          
   8          // 配置GPIO
   9          void gpio_config(void)
  10          {
  11   1              GPIO_InitTypeDef gpioConfigStruct;
  12   1              gpioConfigStruct.Pin = GPIO_Pin_0 | GPIO_Pin_1; // 配置引脚0和1
  13   1              gpioConfigStruct.Mode = GPIO_OUT_PP;                    // 设置为推挽输出模式
  14   1              GPIO_Inilize(GPIO_P3, &gpioConfigStruct);
  15   1      }
  16          
  17          // 配置NVIC
  18          void nvic_config(void)
  19          {
  20   1              COMx_InitDefine COMx_InitStructure; // 结构定义
  21   1      
  22   1              COMx_InitStructure.UART_Mode = UART_8bit_BRTx;  // 模式, UART_ShiftRight,UART_8bit_BRTx,UART_9bit,UART_9
             -bit_BRTx
  23   1              COMx_InitStructure.UART_BRT_Use = BRT_Timer1;   // 选择波特率发生器, BRT_Timer1, BRT_Timer2 (注意
             -: 串口2固定使用BRT_Timer2)
  24   1              COMx_InitStructure.UART_BaudRate = 115200ul;    // 波特率, 一般 110 ~ 115200
  25   1              COMx_InitStructure.UART_RxEnable = ENABLE;              // 接收允许,   ENABLE或DISABLE
  26   1              COMx_InitStructure.BaudRateDouble = DISABLE;    // 波特率加倍, ENABLE或DISABLE
  27   1              UART_Configuration(UART1, &COMx_InitStructure); // 初始化串口1 UART1,UART2,UART3,UART4
  28   1              NVIC_UART1_Init(ENABLE, Priority_1);                    // 中断使能, ENABLE/DISABLE; 优先级(低到高) Priority_0,P
             -riority_1,Priority_2,Priority_3
  29   1      
  30   1              UART1_SW(UART1_SW_P30_P31);
  31   1      }
  32          
  33          // 数据读取发送(回塞)函数
  34          void backPlug(void)
  35          {
  36   1              u8 i;
  37   1              u8 dat;
  38   1              // 按照读取字节的字节数变量缓冲区获取数据，并将获取的数据发送回去
  39   1              for (i = 0; i < COM1.RX_Cnt; i++)
  40   1              {
  41   2                      dat = RX1_Buffer[i];
  42   2                      TX1_write2buff(dat); // 将收到的数据发回去
  43   2              }
  44   1      }
  45          
  46          int main(void)
  47          {
  48   1              //初始化GPIO
  49   1              gpio_config();
  50   1              //初始化NVIC
  51   1              nvic_config();
C51 COMPILER V9.60.7.0   MAIN                                                              06/13/2024 14:16:16 PAGE 2   

  52   1              // 开启中断
  53   1              EA = 1; 
  54   1      
  55   1              while (1)
  56   1              {
  57   2                      /* 超时计数，一旦接收到一个字节，RX_TimeOut就会初始化一个值作为超时值，超
             -此事件视作超时 */
  58   2                      // 超时值有值，证明可能收到数据了，进行进一步判断
  59   2                      if ((COM1.RX_TimeOut > 0) && (--COM1.RX_TimeOut == 0))
  60   2                      {
  61   3                              // 接收到的字节数>0,证明确实是收到数据了
  62   3                              if (COM1.RX_Cnt > 0)
  63   3                              {
  64   4                                      // 调用数据读取函数读取获取到的数据
  65   4                                      backPlug();
  66   4                              }
  67   3                              // 读取完数据，将记录接收数据字节的变量置0
  68   3                              COM1.RX_Cnt = 0;
  69   3                      }
  70   2                      // 延时10ms,避免频繁读取数据
  71   2                      delay_ms(10);
  72   2              }
  73   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    133    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      13
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
